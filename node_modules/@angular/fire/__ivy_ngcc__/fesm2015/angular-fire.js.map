{"version":3,"file":"angular-fire.js","sources":["../../../src/core/angularfire2.ts","../../../src/core/firebase.app.module.ts"],"names":["NG_VERSION"],"mappings":"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","sourcesContent":["import { NgZone } from '@angular/core';\nimport {\n  asyncScheduler,\n  Observable,\n  Operator,\n  queueScheduler,\n  SchedulerAction,\n  SchedulerLike,\n  Subscriber,\n  Subscription,\n  TeardownLogic\n} from 'rxjs';\nimport { observeOn, subscribeOn, tap } from 'rxjs/operators';\n\nfunction noop() {\n}\n\n/**\n * Schedules tasks so that they are invoked inside the Zone that is passed in the constructor.\n */\n// tslint:disable-next-line:class-name\nexport class ÉµZoneScheduler implements SchedulerLike {\n  constructor(private zone: any, private delegate: any = queueScheduler) {\n  }\n\n  now() {\n    return this.delegate.now();\n  }\n\n  schedule(work: (this: SchedulerAction<any>, state?: any) => void, delay?: number, state?: any): Subscription {\n    const targetZone = this.zone;\n    // Wrap the specified work function to make sure that if nested scheduling takes place the\n    // work is executed in the correct zone\n    const workInZone = function(this: SchedulerAction<any>, state: any) {\n      targetZone.runGuarded(() => {\n        work.apply(this, [state]);\n      });\n    };\n\n    // Scheduling itself needs to be run in zone to ensure setInterval calls for async scheduling are done\n    // inside the correct zone. This scheduler needs to schedule asynchronously always to ensure that\n    // firebase emissions are never synchronous. Specifying a delay causes issues with the queueScheduler delegate.\n    return this.delegate.schedule(workInZone, delay, state);\n  }\n}\n\n// tslint:disable-next-line:class-name\nexport class ÉµBlockUntilFirstOperator<T> implements Operator<T, T> {\n  private task: MacroTask | null = null;\n\n  constructor(private zone: any) {\n  }\n\n  call(subscriber: Subscriber<T>, source: Observable<T>): TeardownLogic {\n    const unscheduleTask = this.unscheduleTask.bind(this);\n    this.task = this.zone.run(() => Zone.current.scheduleMacroTask('firebaseZoneBlock', noop, {}, noop, noop));\n\n    return source.pipe(\n      tap({ next: unscheduleTask, complete: unscheduleTask, error: unscheduleTask })\n    ).subscribe(subscriber).add(unscheduleTask);\n  }\n\n  private unscheduleTask() {\n    // maybe this is a race condition, invoke in a timeout\n    // hold for 10ms while I try to figure out what is going on\n    setTimeout(() => {\n      if (this.task != null && this.task.state === 'scheduled') {\n        this.task.invoke();\n        this.task = null;\n      }\n    }, 10);\n  }\n}\n\n// tslint:disable-next-line:class-name\nexport class ÉµAngularFireSchedulers {\n  public readonly outsideAngular: ÉµZoneScheduler;\n  public readonly insideAngular: ÉµZoneScheduler;\n\n  constructor(public ngZone: NgZone) {\n    this.outsideAngular = ngZone.runOutsideAngular(() => new ÉµZoneScheduler(Zone.current));\n    this.insideAngular = ngZone.run(() => new ÉµZoneScheduler(Zone.current, asyncScheduler));\n  }\n}\n\n/**\n * Operator to block the zone until the first value has been emitted or the observable\n * has completed/errored. This is used to make sure that universal waits until the first\n * value from firebase but doesn't block the zone forever since the firebase subscription\n * is still alive.\n */\nexport function ÉµkeepUnstableUntilFirstFactory(schedulers: ÉµAngularFireSchedulers) {\n  return function keepUnstableUntilFirst<T>(obs$: Observable<T>): Observable<T> {\n    obs$ = obs$.lift(\n      new ÉµBlockUntilFirstOperator(schedulers.ngZone)\n    );\n\n    return obs$.pipe(\n      // Run the subscribe body outside of Angular (e.g. calling Firebase SDK to add a listener to a change event)\n      subscribeOn(schedulers.outsideAngular),\n      // Run operators inside the angular zone (e.g. side effects via tap())\n      observeOn(schedulers.insideAngular)\n      // INVESTIGATE https://github.com/angular/angularfire/pull/2315\n      // share()\n    );\n  };\n}\n\n// tslint:disable:ban-types\ntype FunctionPropertyNames<T> = { [K in keyof T]: T[K] extends Function ? K : never }[keyof T];\ntype PromiseReturningFunctionPropertyNames<T> = {\n  [K in FunctionPropertyNames<T>]: ReturnType<T[K]> extends Promise<any> ? K : never\n}[FunctionPropertyNames<T>];\ntype NonPromiseReturningFunctionPropertyNames<T> = {\n  [K in FunctionPropertyNames<T>]: ReturnType<T[K]> extends Promise<any> ? never : K\n}[FunctionPropertyNames<T>];\ntype NonFunctionPropertyNames<T> = { [K in keyof T]: T[K] extends Function ? never : K }[keyof T];\n// tslint:enable:ban-types\n\nexport type ÉµPromiseProxy<T> = { [K in NonFunctionPropertyNames<T>]: Promise<T[K]> } &\n  { [K in NonPromiseReturningFunctionPropertyNames<T>]: (...args: Parameters<T[K]>) => Promise<ReturnType<T[K]>> } &\n  { [K in PromiseReturningFunctionPropertyNames<T>]: (...args: Parameters<T[K]>) => ReturnType<T[K]> };\n\n\n// DEBUG quick debugger function for inline logging that typescript doesn't complain about\n//       wrote it for debugging the ÉµlazySDKProxy, commenting out for now; should consider exposing a\n//       verbose mode for AngularFire in a future release that uses something like this in multiple places\n//       usage: () => log('something') || returnValue\n// const log = (...args: any[]): false => { console.log(...args); return false }\n\n// The problem here are things like ngOnDestroy are missing, then triggering the service\n// rather than dig too far; I'm capturing these as I go.\nconst noopFunctions = ['ngOnDestroy'];\n\n// INVESTIGATE should we make the Proxy revokable and do some cleanup?\n//             right now it's fairly simple but I'm sure this will grow in complexity\nexport const ÉµlazySDKProxy = (klass: any, observable: Observable<any>, zone: NgZone, options: {\n  spy?: {\n    get?: ((name: string, it: any) => void),\n    apply?: ((name: string, args: any[], it: any) => void)\n  }\n} = {}) => {\n  return new Proxy(klass, {\n    get: (_, name: string) => zone.runOutsideAngular(() => {\n      if (klass[name]) {\n        if (options?.spy?.get) {\n          options.spy.get(name, klass[name]);\n        }\n        return klass[name];\n      }\n      if (noopFunctions.indexOf(name) > -1) {\n        return () => {\n        };\n      }\n      const promise = observable.toPromise().then(mod => {\n        const ret = mod && mod[name];\n        // TODO move to proper type guards\n        if (typeof ret === 'function') {\n          return ret.bind(mod);\n        } else if (ret && ret.then) {\n          return ret.then((res: any) => zone.run(() => res));\n        } else {\n          return zone.run(() => ret);\n        }\n      });\n      // recurse the proxy\n      return new Proxy(() => {}, {\n          get: (_, name) => promise[name],\n          // TODO handle callbacks as transparently as I can\n          apply: (self, _, args) => promise.then(it => {\n            const res = it && it(...args);\n            if (options?.spy?.apply) {\n              options.spy.apply(name, args, res);\n            }\n            return res;\n          })\n        }\n      );\n    })\n  });\n};\n\nexport const ÉµapplyMixins = (derivedCtor: any, constructors: any[]) => {\n  constructors.forEach((baseCtor) => {\n    Object.getOwnPropertyNames(baseCtor.prototype || baseCtor).forEach((name) => {\n      Object.defineProperty(\n        derivedCtor.prototype,\n        name,\n        Object.getOwnPropertyDescriptor(baseCtor.prototype || baseCtor, name)\n      );\n    });\n  });\n};\n","import {\n  Inject, InjectionToken, isDevMode, ModuleWithProviders, NgModule, NgZone, Optional, PLATFORM_ID, VERSION as NG_VERSION, Version\n} from '@angular/core';\nimport firebase from 'firebase/app';\n\n// INVESTIGATE Public types don't expose FirebaseOptions or FirebaseAppConfig, is this the case anylonger?\nexport interface FirebaseOptions {\n  [key: string]: any;\n}\n\nexport interface FirebaseAppConfig {\n  [key: string]: any;\n}\n\nexport const FIREBASE_OPTIONS = new InjectionToken<FirebaseOptions>('angularfire2.app.options');\nexport const FIREBASE_APP_NAME = new InjectionToken<string | FirebaseAppConfig | undefined>('angularfire2.app.nameOrConfig');\n\n// Have to implement as we need to return a class from the provider, we should consider exporting\n// this in the firebase/app types as this is our highest risk of breaks\nexport class FirebaseApp implements Partial<firebase.app.App> {\n  name: string;\n  options: {};\n  analytics: () => firebase.analytics.Analytics;\n  auth: () => firebase.auth.Auth;\n  database: (databaseURL?: string) => firebase.database.Database;\n  messaging: () => firebase.messaging.Messaging;\n  performance: () => firebase.performance.Performance;\n  storage: (storageBucket?: string) => firebase.storage.Storage;\n  delete: () => Promise<void>;\n  firestore: () => firebase.firestore.Firestore;\n  functions: (region?: string) => firebase.functions.Functions;\n  remoteConfig: () => firebase.remoteConfig.RemoteConfig;\n}\n\nexport const VERSION = new Version('ANGULARFIRE2_VERSION');\n\nexport function ÉµfirebaseAppFactory(options: FirebaseOptions, zone: NgZone, nameOrConfig?: string | FirebaseAppConfig | null) {\n  const name = typeof nameOrConfig === 'string' && nameOrConfig || '[DEFAULT]';\n  const config = typeof nameOrConfig === 'object' && nameOrConfig || {};\n  config.name = config.name || name;\n  // Added any due to some inconsistency between @firebase/app and firebase types\n  const existingApp = firebase.apps.filter(app => app && app.name === config.name)[0] as any;\n  // We support FirebaseConfig, initializeApp's public type only accepts string; need to cast as any\n  // Could be solved with https://github.com/firebase/firebase-js-sdk/pull/1206\n  const app = (existingApp || zone.runOutsideAngular(() => firebase.initializeApp(options, config as any))) as FirebaseApp;\n  try {\n    if (JSON.stringify(options) !== JSON.stringify(app.options)) {\n      const hmr = !!(module as any).hot;\n      log('error', `${app.name} Firebase App already initialized with different options${hmr ? ', you may need to reload as Firebase is not HMR aware.' : '.'}`);\n    }\n  } catch (e) { }\n  return app;\n}\n\nexport const ÉµlogAuthEmulatorError = () => {\n  // TODO sort this out, https://github.com/angular/angularfire/issues/2656\n  log('warn', 'You may need to import \\'firebase/auth\\' manually in your component rather than rely on AngularFireAuth\\'s dynamic import, when using the emulator suite https://github.com/angular/angularfire/issues/2656');\n};\n\nconst log = (level: 'log'|'error'|'info'|'warn', ...args: any) => {\n  if (isDevMode() && typeof console !== 'undefined') {\n    console[level](...args);\n  }\n};\n\nglobalThis.ÉµAngularfireInstanceCache ||= new Map();\n\nexport function ÉµfetchInstance<T>(cacheKey: any, moduleName: string, app: FirebaseApp, fn: () => T, args: any[]): T {\n  const [instance, ...cachedArgs] = globalThis.ÉµAngularfireInstanceCache.get(cacheKey) || [];\n  if (instance) {\n    try {\n      if (args.some((arg, i) => {\n        const cachedArg = cachedArgs[i];\n        if (arg && typeof arg === 'object') {\n          return JSON.stringify(arg) !== JSON.stringify(cachedArg);\n        } else {\n          return arg !== cachedArg;\n        }\n      })) {\n        const hmr = !!(module as any).hot;\n        log('error', `${moduleName} was already initialized on the ${app.name} Firebase App instance with different settings.${hmr ? ' You may need to reload as Firebase is not HMR aware.' : ''}`);\n      }\n    } catch (e) { }\n    return instance;\n  } else {\n    const newInstance = fn();\n    globalThis.ÉµAngularfireInstanceCache.set(cacheKey, [newInstance, ...args]);\n    return newInstance;\n  }\n}\n\nconst FIREBASE_APP_PROVIDER = {\n  provide: FirebaseApp,\n  useFactory: ÉµfirebaseAppFactory,\n  deps: [\n    FIREBASE_OPTIONS,\n    NgZone,\n    [new Optional(), FIREBASE_APP_NAME]\n  ]\n};\n\n@NgModule({\n  providers: [FIREBASE_APP_PROVIDER]\n})\nexport class AngularFireModule {\n  static initializeApp(options: FirebaseOptions, nameOrConfig?: string | FirebaseAppConfig): ModuleWithProviders<AngularFireModule> {\n    return {\n      ngModule: AngularFireModule,\n      providers: [\n        {provide: FIREBASE_OPTIONS, useValue: options},\n        {provide: FIREBASE_APP_NAME, useValue: nameOrConfig}\n      ]\n    };\n  }\n\n  // tslint:disable-next-line:ban-types\n  constructor(@Inject(PLATFORM_ID) platformId: Object) {\n    firebase.registerVersion('angularfire', VERSION.full, platformId.toString());\n    firebase.registerVersion('angular', NG_VERSION.full);\n  }\n}\n"]}